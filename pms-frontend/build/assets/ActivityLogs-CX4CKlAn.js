import{S as nt,u as dt}from"./usePermission-CYqkqYTp.js";import{c as J,a5 as ct,n as $,j as P,p as z,d as M,o as n,f as u,F as B,m as N,b as t,t as o,v as U,g as w,h as C,e as v,S as gt,x as T,y as O,a6 as ut,Y as K,a7 as yt,i as L,a as A,D as H,a8 as tt,C as xt,a9 as vt,W as bt,aa as pt,P as mt,I as kt,T as ft,V as I,a0 as ht,l as wt,ab as _t}from"./index-BGKEJEuu.js";import{L as $t}from"./log-out-CJiBn1jY.js";import{S as at}from"./smartphone-DlL1Lrgl.js";import{S as Ct}from"./settings-DtUEWWXi.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=J("LogInIcon",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=J("MonitorIcon",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=J("TabletIcon",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]]),st=ct("activityLogs",()=>{const a=$([]),y=$(null),d=$(null),b=$(!1),s=$(1),l=$(1),k=$(50),p=$(0),r=$({search:"",action_type:"all",start_date:"",end_date:""}),g=P(()=>r.value.search!==""||r.value.action_type!=="all"||r.value.start_date!==""||r.value.end_date!==""),x=P(()=>{let e=0;return r.value.search&&e++,r.value.action_type!=="all"&&e++,r.value.start_date&&e++,r.value.end_date&&e++,e}),f=P(()=>{const e=[];return r.value.search&&e.push({key:"search",label:"Search",value:r.value.search}),r.value.action_type!=="all"&&e.push({key:"action_type",label:"Action Type",value:r.value.action_type.charAt(0).toUpperCase()+r.value.action_type.slice(1)}),r.value.start_date&&e.push({key:"start_date",label:"Start Date",value:new Date(r.value.start_date).toLocaleDateString()}),r.value.end_date&&e.push({key:"end_date",label:"End Date",value:new Date(r.value.end_date).toLocaleDateString()}),e}),h=async()=>{b.value=!0;try{const e={page:s.value,per_page:k.value,search:r.value.search||void 0,action_type:r.value.action_type!=="all"?r.value.action_type:void 0,start_date:r.value.start_date||void 0,end_date:r.value.end_date||void 0},m=await z.get("/api/activity-logs",{params:e});a.value=m.data.data||[],l.value=m.data.last_page||1,s.value=m.data.current_page||1,p.value=m.data.total||0,k.value=m.data.per_page||50}catch(e){throw console.error("Failed to fetch logs:",e),a.value=[],e}finally{b.value=!1}},S=async()=>{try{const e={start_date:r.value.start_date||void 0,end_date:r.value.end_date||void 0},m=await z.get("/api/activity-logs/statistics",{params:e});y.value=m.data}catch(e){throw console.error("Failed to fetch statistics:",e),y.value=null,e}},c=async()=>{try{const e=await z.get("/api/activity-logs/settings");d.value=e.data}catch(e){throw console.error("Failed to fetch settings:",e),d.value=null,e}};return{logs:a,statistics:y,settings:d,loading:b,currentPage:s,totalPages:l,perPage:k,totalLogs:p,filters:r,hasActiveFilters:g,activeFiltersCount:x,activeFiltersList:f,fetchLogs:h,fetchStatistics:S,fetchSettings:c,updateSettings:async e=>{b.value=!0;try{const m=await z.put("/api/activity-logs/settings",e);d.value=m.data}catch(m){throw console.error("Failed to update settings:",m),m}finally{b.value=!1}},triggerCleanup:async()=>{b.value=!0;try{const e=await z.post("/api/activity-logs/settings/cleanup");return await Promise.all([h(),S()]),e.data}catch(e){throw console.error("Failed to cleanup logs:",e),e}finally{b.value=!1}},exportLogs:async()=>{b.value=!0;try{const e={search:r.value.search||void 0,action_type:r.value.action_type!=="all"?r.value.action_type:void 0,start_date:r.value.start_date||void 0,end_date:r.value.end_date||void 0};return(await z.get("/api/activity-logs/export/data",{params:e})).data.data||[]}catch(e){throw console.error("Failed to export logs:",e),e}finally{b.value=!1}},setFilter:(e,m)=>{r.value[e]=m},removeFilter:e=>{e==="action_type"?r.value[e]="all":r.value[e]=""},resetFilters:()=>{r.value={search:"",action_type:"all",start_date:"",end_date:""}},applyFilters:async()=>{s.value=1,await Promise.all([h(),S()])},goToPage:async e=>{e<1||e>l.value||(s.value=e,await h())},nextPage:async()=>{s.value<l.value&&(s.value++,await h())},previousPage:async()=>{s.value>1&&(s.value--,await h())},initialize:async()=>{b.value=!0;try{await Promise.all([h(),S(),c()])}catch(e){throw console.error("Failed to initialize activity logs store:",e),e}finally{b.value=!1}},clearState:()=>{a.value=[],y.value=null,d.value=null,s.value=1,l.value=1,p.value=0,k.value=50,r.value={search:"",action_type:"all",start_date:"",end_date:""},b.value=!1}}}),Ft={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3"},Lt={class:"flex items-center justify-between"},Pt={class:"text-[11px] font-medium tracking-widest uppercase text-slate-400 dark:text-slate-500"},Dt={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-full h-full"},At=["d"],Mt={class:"h-0.5 rounded-full bg-slate-100 dark:bg-white/5 overflow-hidden"},zt=M({__name:"StatisticsCards",props:{statistics:{}},setup(a){const y=[{key:"total_activities",label:"Total Activities",getValue:d=>d.total_activities,valueClass:"text-slate-700 dark:text-slate-300",iconClass:"text-slate-400 dark:text-slate-500",barClass:"bg-slate-400 dark:bg-slate-500",iconPath:"M3 12h4l3-9 4 18 3-9h4"},{key:"total_logins",label:"User Logins",getValue:d=>d.total_logins,valueClass:"text-emerald-600 dark:text-emerald-400",iconClass:"text-emerald-500 dark:text-emerald-500",barClass:"bg-emerald-500 dark:bg-emerald-400",iconPath:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M15 12H3"},{key:"creates_updates",label:"Creates + Updates",getValue:d=>d.total_creates+d.total_updates,valueClass:"text-sky-600 dark:text-sky-400",iconClass:"text-sky-500 dark:text-sky-500",barClass:"bg-sky-500 dark:bg-sky-400",iconPath:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"},{key:"unique_users",label:"Unique Users",getValue:d=>d.unique_users,valueClass:"text-violet-600 dark:text-violet-400",iconClass:"text-violet-500 dark:text-violet-500",barClass:"bg-violet-500 dark:bg-violet-400",iconPath:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"}];return(d,b)=>a.statistics?(n(),u("div",Ft,[(n(),u(B,null,N(y,s=>{var l;return t("div",{key:s.key,class:"group relative flex flex-col gap-3 rounded-xl border border-slate-200 dark:border-white/[0.06] bg-white dark:bg-[#131c2e] px-4 pt-4 pb-3 overflow-hidden transition-all duration-200 hover:-translate-y-px hover:shadow-md hover:border-slate-300 dark:hover:border-white/[0.11] dark:hover:bg-[#16203a] cursor-default"},[t("div",Lt,[t("span",Pt,o(s.label),1),t("span",{class:U(["w-4 h-4 opacity-60 group-hover:opacity-100 transition-opacity",s.iconClass])},[(n(),u("svg",Dt,[t("path",{d:s.iconPath},null,8,At)]))],2)]),t("div",{class:U(["font-mono text-[28px] font-medium leading-none tracking-tight",s.valueClass])},o(((l=s.getValue(a.statistics))==null?void 0:l.toLocaleString())??"â€”"),3),t("div",Mt,[t("div",{class:U(["h-full w-[55%] rounded-full opacity-70",s.barClass])},null,2)])])}),64))])):w("",!0)}}),Ut={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 space-y-4 transition-colors"},jt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Vt={class:"relative"},Tt=["value"],It={key:0,class:"flex flex-wrap items-center gap-2 pt-2 border-t border-gray-200 dark:border-gray-700"},Bt={class:"text-sm flex flex-wrap gap-2"},Nt={class:"font-medium"},Ot=["onClick"],Rt={class:"flex items-center justify-between"},Et={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},qt={class:"flex items-center gap-2 ml-auto"},Ht=M({__name:"FiltersSection",props:{filters:{},actionTypes:{},hasActiveFilters:{type:Boolean},activeFiltersCount:{},activeFiltersList:{}},emits:["apply-filters","reset-filters","remove-filter"],setup(a,{emit:y}){const d=y;return(b,s)=>(n(),u("div",Ut,[t("div",jt,[t("div",null,[s[7]||(s[7]=t("label",{class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},"Search User",-1)),t("div",Vt,[C(v(gt),{size:16,class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500"}),T(t("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>a.filters.search=l),type:"text",placeholder:"Email or name...",class:"text-sm w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors"},null,512),[[O,a.filters.search]])])]),t("div",null,[s[8]||(s[8]=t("label",{class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},"Action Type",-1)),T(t("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>a.filters.action_type=l),class:"text-sm w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors"},[(n(!0),u(B,null,N(a.actionTypes,l=>(n(),u("option",{key:l.value,value:l.value},o(l.label),9,Tt))),128))],512),[[ut,a.filters.action_type]])]),t("div",null,[s[9]||(s[9]=t("label",{class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},"Start Date",-1)),T(t("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>a.filters.start_date=l),type:"date",class:"text-sm w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors"},null,512),[[O,a.filters.start_date]])]),t("div",null,[s[10]||(s[10]=t("label",{class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},"End Date",-1)),T(t("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>a.filters.end_date=l),type:"date",class:"text-sm w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors"},null,512),[[O,a.filters.end_date]])])]),a.hasActiveFilters?(n(),u("div",It,[s[11]||(s[11]=t("span",{class:"text-xs font-medium text-gray-700 dark:text-gray-300"},"Active Filters:",-1)),t("div",Bt,[(n(!0),u(B,null,N(a.activeFiltersList,l=>(n(),u("div",{key:l.key,class:"inline-flex items-center gap-1.5 px-3 py-1 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-sm transition-colors"},[t("span",Nt,o(l.label)+":",1),t("span",null,o(l.value),1),t("button",{onClick:k=>d("remove-filter",l.key),class:"ml-1 hover:bg-blue-100 dark:hover:bg-blue-800/50 rounded-full p-0.5 transition-colors",title:"Remove filter"},[C(v(K),{size:14})],8,Ot)]))),128))]),t("button",{onClick:s[4]||(s[4]=l=>d("reset-filters")),class:"ml-auto text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 font-medium transition-colors"}," Clear All Filters ")])):w("",!0),t("div",Rt,[a.hasActiveFilters?(n(),u("div",Et,o(a.activeFiltersCount)+" filter"+o(a.activeFiltersCount!==1?"s":"")+" active ",1)):w("",!0),t("div",qt,[a.hasActiveFilters?(n(),u("button",{key:0,onClick:s[5]||(s[5]=l=>d("reset-filters")),class:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 transition-colors"}," Clear Filters ")):w("",!0),t("button",{onClick:s[6]||(s[6]=l=>d("apply-filters")),class:"text-sm px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 flex items-center gap-2 transition-colors"},[C(v(yt),{size:16}),s[12]||(s[12]=L(" Apply Filters ",-1))])])])]))}}),Jt={class:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden transition-colors"},Kt={class:"overflow-x-auto"},Yt={class:"w-full"},Wt={class:"divide-y divide-gray-200 dark:divide-gray-700"},Xt={key:0},Gt={key:1},Qt={class:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100"},Zt={class:"px-4 py-3 text-sm"},te={class:"font-medium text-gray-900 dark:text-gray-100"},ee={class:"text-gray-500 dark:text-gray-400"},ae={class:"px-4 py-3"},re={class:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100"},se={class:"px-4 py-3 text-sm"},oe={class:"flex items-center gap-2 text-gray-600 dark:text-gray-400"},le={key:0,class:"text-xs text-gray-500 dark:text-gray-500 mt-1"},ie={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400 font-mono"},ne={class:"px-4 py-3 text-center"},de=["onClick"],ce={key:0,class:"px-6 py-4 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},ge={class:"text-sm text-gray-500 dark:text-gray-400"},ue={class:"font-medium text-gray-700 dark:text-gray-300"},ye={class:"font-medium text-gray-700 dark:text-gray-300"},xe={class:"flex items-center space-x-1"},ve=["disabled"],be={class:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300"},pe=["disabled"],me=M({__name:"LogsTable",props:{logs:{},loading:{type:Boolean},currentPage:{},totalPages:{}},emits:["view-details","previous-page","next-page"],setup(a,{emit:y}){const d=y,b=p=>({login:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300",login_failed:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",logout:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300",create:"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",update:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300",delete:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",register:"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300"})[p]||"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300",s=p=>({login:St,logout:$t,create:mt,update:pt,delete:bt})[p]||tt,l=p=>{if(!p)return R;const r=p.toLowerCase();return r.includes("mobile")?at:r.includes("tablet")?rt:R},k=p=>new Date(p).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(p,r)=>(n(),u("div",Jt,[t("div",Kt,[t("table",Yt,[r[4]||(r[4]=t("thead",{class:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-400 uppercase"},"Date/Time"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-400 uppercase"},"User"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-400 uppercase"},"Action"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-400 uppercase"},"Description"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-400 uppercase"},"Device"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-400 uppercase"},"IP Address"),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-600 dark:text-gray-400 uppercase"},"Actions")])],-1)),t("tbody",Wt,[a.loading?(n(),u("tr",Xt,[...r[2]||(r[2]=[t("td",{colspan:"7",class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},[t("div",{class:"flex flex-col items-center"},[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 dark:border-blue-400 mb-2"}),L(" Loading logs... ")])],-1)])])):a.logs.length===0?(n(),u("tr",Gt,[...r[3]||(r[3]=[t("td",{colspan:"7",class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"}," No activity logs found ",-1)])])):(n(!0),u(B,{key:2},N(a.logs,g=>{var x,f,h;return n(),u("tr",{key:g.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("td",Qt,o(k(g.created_at)),1),t("td",Zt,[t("div",te,o((x=g.employee)==null?void 0:x.first_name)+" "+o((f=g.employee)==null?void 0:f.last_name),1),t("div",ee,o(g.email),1)]),t("td",ae,[t("span",{class:U([b(g.action_type),"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium transition-colors capitalize"])},[(n(),A(H(s(g.action_type)),{size:14})),L(" "+o(((h=g.action_type)==null?void 0:h.replace("_"," "))||"Unknown"),1)],2)]),t("td",re,o(g.description),1),t("td",se,[t("div",oe,[(n(),A(H(l(g.device_type)),{size:16})),t("span",null,o(g.device_type||"Unknown"),1)]),g.browser?(n(),u("div",le,o(g.browser)+o(g.browser_version?" "+g.browser_version:""),1)):w("",!0)]),t("td",ie,o(g.ip_address),1),t("td",ne,[t("button",{onClick:S=>d("view-details",g),class:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",title:"View Details"},[C(v(tt),{size:18})],8,de)])])}),128))])])]),!a.loading&&a.logs.length>0?(n(),u("div",ce,[t("p",ge,[r[5]||(r[5]=L(" Page ",-1)),t("span",ue,o(a.currentPage),1),r[6]||(r[6]=L(" of ",-1)),t("span",ye,o(a.totalPages),1)]),t("div",xe,[t("button",{onClick:r[0]||(r[0]=g=>d("previous-page")),disabled:a.currentPage<=1,class:"p-1.5 rounded-md text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors"},[C(v(xt),{size:18})],8,ve),t("span",be,o(a.currentPage)+" / "+o(a.totalPages),1),t("button",{onClick:r[1]||(r[1]=g=>d("next-page")),disabled:a.currentPage>=a.totalPages,class:"p-1.5 rounded-md text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors"},[C(v(vt),{size:18})],8,pe)])])):w("",!0)]))}}),ke={class:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center z-50 p-4 !mt-0"},fe={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-hidden border border-gray-200 dark:border-gray-700"},he={class:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700"},we=["disabled"],_e={key:0,class:"absolute inset-0 bg-white dark:bg-gray-800 bg-opacity-75 dark:bg-opacity-75 flex items-center justify-center z-10 rounded-lg"},$e={class:"p-6 overflow-y-auto max-h-[calc(90vh-180px)] modal-scroll"},Ce={class:"flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/30"},Se=["disabled"],Fe=["disabled"],Le={key:0,class:"animate-spin h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},Pe=M({__name:"SettingsModal",props:{settings:{},permissionKey:{}},emits:["close","saved"],setup(a,{emit:y}){const d=a,b=y,s=st(),l=$({retention_months:3,max_id:1e6,auto_cleanup_enabled:!0}),k=P(()=>s.loading);kt(()=>d.settings,g=>{g&&(l.value={retention_months:g.retention_months,max_id:g.max_id,auto_cleanup_enabled:g.auto_cleanup_enabled})},{immediate:!0});const p=()=>{b("close")},r=async()=>{try{await s.updateSettings(l.value),I.success("Settings updated successfully"),b("saved")}catch{I.error("Failed to update settings")}};return(g,x)=>(n(),u("div",ke,[t("div",fe,[t("div",he,[x[1]||(x[1]=t("div",null,[t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"}," Activity Log Settings "),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Configure log retention and cleanup settings ")],-1)),t("button",{onClick:p,class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:k.value},[C(v(K),{size:20,class:"text-gray-500 dark:text-gray-400"})],8,we)]),k.value?(n(),u("div",_e,[...x[2]||(x[2]=[t("div",{class:"flex flex-col items-center"},[t("svg",{class:"w-8 h-8 animate-spin text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})]),t("span",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},"Saving settings...")],-1)])])):w("",!0),t("div",$e,[t("form",{onSubmit:ft(r,["prevent"]),class:"space-y-4"},[t("div",null,[x[3]||(x[3]=t("label",{for:"retention-months",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[L(" Retention Period (Months) "),t("span",{class:"text-red-500"},"*")],-1)),T(t("input",{id:"retention-months","onUpdate:modelValue":x[0]||(x[0]=f=>l.value.retention_months=f),type:"number",min:"1",max:"60",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 focus:border-gray-500 dark:focus:border-gray-400 focus:ring-2 focus:ring-gray-200 dark:focus:ring-gray-400/50 outline-none transition-colors bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:""},null,512),[[O,l.value.retention_months,void 0,{number:!0}]]),x[4]||(x[4]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"}," Logs older than this will be automatically deleted ",-1))])],32)]),t("div",Ce,[t("button",{onClick:p,class:"px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm font-medium disabled:opacity-50",disabled:k.value}," Cancel ",8,Se),t("button",{onClick:r,class:"px-4 py-2.5 bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-800 transition-colors flex items-center gap-2 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:k.value},[k.value?(n(),u("svg",Le,[...x[5]||(x[5]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(n(),A(v(nt),{key:1,size:16})),x[6]||(x[6]=t("span",null,"Save Settings",-1))],8,Fe)])])]))}}),De={class:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center z-50 p-4 !mt-0"},Ae={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden border border-gray-200 dark:border-gray-700"},Me={class:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700"},ze={class:"p-6 overflow-y-auto max-h-[calc(90vh-180px)] modal-scroll"},Ue={class:"space-y-4"},je={class:"grid grid-cols-2 gap-4"},Ve={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Te={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ie={class:"text-sm text-gray-500 dark:text-gray-400"},Be={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ne={key:0},Oe={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Re={class:"grid grid-cols-2 gap-4"},Ee={class:"font-mono text-sm text-gray-900 dark:text-gray-100"},qe={class:"text-sm flex items-center gap-2 text-gray-900 dark:text-gray-100"},He={key:1},Je={class:"text-sm text-gray-900 dark:text-gray-100"},Ke={key:2},Ye={class:"text-sm text-gray-900 dark:text-gray-100"},We={class:"text-sm text-gray-500 dark:text-gray-100 break-all"},Xe={key:3,class:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700"},Ge={class:"space-y-3"},Qe={class:"text-xs font-medium text-gray-600 dark:text-gray-400 uppercase mb-1"},Ze={class:"grid grid-cols-2 gap-4"},ta={key:0},ea={class:"text-sm bg-red-50 dark:bg-red-900/20 text-red-900 dark:text-red-300 px-2 py-1 rounded border border-red-200 dark:border-red-800 break-words"},aa={class:"text-xs text-gray-500 dark:text-gray-500 mb-1"},ra={class:"text-sm bg-green-50 dark:bg-green-900/20 text-green-900 dark:text-green-300 px-2 py-1 rounded border border-green-200 dark:border-green-800 break-words"},sa=M({__name:"DetailsModal",props:{log:{}},emits:["close"],setup(a,{emit:y}){const d=a,b=y,s=()=>{b("close")},l=c=>({login:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300",logout:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300",create:"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",update:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300",delete:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"})[c]||"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300",k=c=>c==null?"N/A":typeof c=="boolean"?c?"Yes":"No":typeof c=="object"?JSON.stringify(c,null,2):String(c),p=c=>{if(!c)return R;const i=c.toLowerCase();return i.includes("mobile")?at:i.includes("tablet")?rt:R},r=c=>new Date(c).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),g=c=>{if(!c)return null;if(typeof c=="object")return c;try{return JSON.parse(c)}catch(i){return console.error("Failed to parse changes:",i),null}},x=P(()=>d.log.changes&&(d.log.changes.old||d.log.changes.new)),f=P(()=>{var c;return(c=d.log.changes)!=null&&c.old?g(d.log.changes.old):null}),h=P(()=>{var c;return(c=d.log.changes)!=null&&c.new?g(d.log.changes.new):null}),S=P(()=>{if(!x.value)return[];const c=new Set([...Object.keys(f.value||{}),...Object.keys(h.value||{})]);return Array.from(c)});return(c,i)=>{var j,D;return n(),u("div",De,[t("div",Ae,[t("div",Me,[i[0]||(i[0]=t("div",null,[t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"}," Activity Details "),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," Complete information about this activity ")],-1)),t("button",{onClick:s,class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[C(v(K),{size:20,class:"text-gray-500 dark:text-gray-400"})])]),t("div",ze,[t("div",Ue,[t("div",je,[t("div",null,[i[1]||(i[1]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Date/Time",-1)),t("div",Ve,o(r(a.log.created_at)),1)]),t("div",null,[i[2]||(i[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Action Type",-1)),t("span",{class:U([l(a.log.action_type),"text-sm inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium transition-colors"])},o(a.log.action_type),3)])]),t("div",null,[i[3]||(i[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"User",-1)),t("div",Te,o((j=a.log.employee)==null?void 0:j.first_name)+" "+o((D=a.log.employee)==null?void 0:D.last_name),1),t("div",Ie,o(a.log.email),1)]),t("div",null,[i[4]||(i[4]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Description",-1)),t("div",Be,o(a.log.description),1)]),a.log.model_type?(n(),u("div",Ne,[i[5]||(i[5]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Model",-1)),t("div",Oe,o(a.log.model_type.split("\\").pop())+" (ID: "+o(a.log.model_id)+") ",1)])):w("",!0),t("div",Re,[t("div",null,[i[6]||(i[6]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"IP Address",-1)),t("div",Ee,o(a.log.ip_address),1)]),t("div",null,[i[7]||(i[7]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Device Type",-1)),t("div",qe,[(n(),A(H(p(a.log.device_type)),{size:16})),L(" "+o(a.log.device_type||"Unknown"),1)])])]),a.log.browser?(n(),u("div",He,[i[8]||(i[8]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Browser",-1)),t("div",Je,o(a.log.browser)+o(a.log.browser_version?" "+a.log.browser_version:""),1)])):w("",!0),a.log.platform?(n(),u("div",Ke,[i[9]||(i[9]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"Platform",-1)),t("div",Ye,o(a.log.platform)+o(a.log.platform_version?" "+a.log.platform_version:""),1)])):w("",!0),t("div",null,[i[10]||(i[10]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"User Agent",-1)),t("div",We,o(a.log.user_agent),1)]),x.value?(n(),u("div",Xe,[i[12]||(i[12]=t("div",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"Changes",-1)),t("div",Ge,[(n(!0),u(B,null,N(S.value,F=>{var V;return n(),u("div",{key:F,class:"border-l-2 border-blue-500 pl-3"},[t("div",Qe,o(String(F).replace(/_/g," ")),1),t("div",Ze,[f.value&&f.value[F]!==void 0?(n(),u("div",ta,[i[11]||(i[11]=t("div",{class:"text-xs text-gray-500 dark:text-gray-500 mb-1"},"Old Value",-1)),t("div",ea,o(k(f.value[F])),1)])):w("",!0),t("div",{class:U(f.value&&f.value[F]!==void 0?"":"col-span-2")},[t("div",aa,o(f.value&&f.value[F]!==void 0?"New Value":"Value"),1),t("div",ra,o(k((V=h.value)==null?void 0:V[F])),1)],2)])])}),128))])])):w("",!0)])]),t("div",{class:"flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/30"},[t("button",{onClick:s,class:"px-4 py-2.5 bg-gray-600 dark:bg-gray-700 text-white rounded-lg hover:bg-gray-700 dark:hover:bg-gray-800 transition-colors text-sm font-medium"}," Close ")])])])}}}),oa={class:"p-0 md:p-6 space-y-6"},la={class:"flex items-center justify-between",'"':""},ia={class:"flex items-center gap-3"},et="activity_logs",na=M({__name:"index",setup(a){const y=st(),{logs:d,statistics:b,settings:s,loading:l,currentPage:k,totalPages:p,filters:r,hasActiveFilters:g,activeFiltersCount:x,activeFiltersList:f}=ht(y),{canUpdate:h}=dt(),S=$(!1),c=$(!1),i=$(null),j=[{value:"all",label:"All Actions"},{value:"login",label:"Login"},{value:"logout",label:"Logout"},{value:"create",label:"Create"},{value:"update",label:"Update"},{value:"delete",label:"Delete"}],D=async()=>{try{await y.applyFilters()}catch{I.error("Failed to apply filters")}},F=async()=>{y.resetFilters(),await D()},V=async _=>{y.removeFilter(_),await D()},Y=_=>{i.value=_,c.value=!0},W=()=>{S.value=!0},E=()=>{S.value=!1},X=()=>{E()},G=()=>{c.value=!1,i.value=null},Q=async()=>{try{const _=await y.exportLogs();if(_.length===0){I.error("No data to export");return}const e=Object.keys(_[0]),m=[e.join(","),..._.map(lt=>e.map(it=>`"${lt[it]??""}"`).join(","))].join(`
`),ot=new Blob([m],{type:"text/csv"}),Z=window.URL.createObjectURL(ot),q=document.createElement("a");q.href=Z,q.download=`activity-logs-${new Date().toISOString().split("T")[0]}.csv`,q.click(),window.URL.revokeObjectURL(Z)}catch{I.error("Failed to export logs")}};return wt(async()=>{try{await y.initialize()}catch(_){console.error("Failed to initialize:",_)}}),(_,e)=>(n(),u("div",oa,[t("div",la,[e[4]||(e[4]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Activity Logs"),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},"Track user activities and system events")],-1)),t("div",ia,[t("button",{onClick:Q,class:"text-sm px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-2 transition-colors"},[C(v(_t),{size:16}),e[2]||(e[2]=L(" Export ",-1))]),v(h)(et)?(n(),u("button",{key:0,onClick:W,class:"text-sm px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 flex items-center gap-2 transition-colors"},[C(v(Ct),{size:16}),e[3]||(e[3]=L(" Settings ",-1))])):w("",!0)])]),C(zt,{statistics:v(b)},null,8,["statistics"]),C(Ht,{filters:v(r),"action-types":j,"has-active-filters":v(g),"active-filters-count":v(x),"active-filters-list":v(f),onApplyFilters:D,onResetFilters:F,onRemoveFilter:V},null,8,["filters","has-active-filters","active-filters-count","active-filters-list"]),C(me,{logs:v(d),loading:v(l),"current-page":v(k),"total-pages":v(p),onViewDetails:Y,onPreviousPage:e[0]||(e[0]=m=>v(y).previousPage()),onNextPage:e[1]||(e[1]=m=>v(y).nextPage())},null,8,["logs","loading","current-page","total-pages"]),S.value?(n(),A(Pe,{key:0,settings:v(s),"permission-key":et,onClose:E,onSaved:X},null,8,["settings"])):w("",!0),c.value&&i.value?(n(),A(sa,{key:1,log:i.value,onClose:G},null,8,["log"])):w("",!0)]))}}),xa=M({__name:"ActivityLogs",setup(a){return(y,d)=>(n(),A(na))}});export{xa as default};
